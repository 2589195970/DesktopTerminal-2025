# Windows 7 兼容性测试计划

## 测试环境要求

### 目标系统规格
- **操作系统**: Windows 7 Ultimate Edition (x86) Service Pack 1 Build 7601
- **CPU**: Intel i7-4790（或同等性能）
- **内存**: 2GB RAM
- **浏览器**: Chrome 109.xxx (32位) - 已验证可运行

### 前置条件检查
- [ ] 系统已安装Chrome 109.xxx且运行正常
- [ ] 确认系统架构为32位
- [ ] 验证.NET Framework版本（推荐4.5+）
- [ ] 检查Windows Update状态

## 问题诊断清单

### 1. 运行时环境检查
```cmd
# 检查VC++ Runtime安装状态
reg query "HKLM\SOFTWARE\Microsoft\VisualStudio\14.0\VC\Runtimes\x86"

# 检查系统架构
echo %PROCESSOR_ARCHITECTURE%

# 检查Chrome版本
chrome.exe --version
```

### 2. QtWebEngine特定问题排查

**问题A: GPU进程崩溃**
- 症状：程序启动后立即崩溃，无界面显示
- 解决：检查显卡驱动，尝试禁用硬件加速
- 验证：查看Windows事件日志中的应用程序错误

**问题B: 沙箱模式不兼容**  
- 症状：程序启动但网页内容为空白
- 解决：禁用WebEngine沙箱模式
- 验证：检查是否有QtWebEngineProcess.exe进程

**问题C: 内存不足**
- 症状：程序运行缓慢或频繁崩溃
- 解决：减少内存占用，优化WebEngine设置
- 验证：使用任务管理器监控内存使用

### 3. 分步测试方案

#### 第一步：基础环境验证
1. 在目标机器上安装VC++ 2017 Redistributable (x86)
2. 验证安装是否成功
3. 重启系统确保运行时加载

#### 第二步：最小化测试
1. 使用修改后的Qt 5.12.12版本构建
2. 启用所有Windows 7兼容性设置
3. 测试基本启动功能

#### 第三步：功能测试
1. 验证WebEngine页面加载
2. 测试全屏和热键功能
3. 检查日志文件生成

#### 第四步：压力测试
1. 长时间运行稳定性测试
2. 内存泄漏检查
3. 多次启动/退出测试

## 兼容性修复版本对比

### 原版本 (Qt 5.15.2)
- Chromium 83内核
- MSVC 2019编译
- 硬件加速默认启用

### 兼容版本 (Qt 5.12.12)
- Chromium 69内核（与Chrome 69相当）
- MSVC 2017编译
- Windows 7特殊优化：
  - 强制禁用GPU进程
  - 禁用沙箱模式
  - 软件渲染回退
  - 减少插件和JavaScript功能

## 测试用例

### 用例1：程序启动测试
- **输入**：双击桌面快捷方式
- **预期**：程序启动，显示全屏浏览器界面
- **验证**：检查log/startup.log文件

### 用例2：网页加载测试  
- **输入**：配置有效的考试网站URL
- **预期**：网页正常加载显示
- **验证**：页面内容可见，无空白页面

### 用例3：热键退出测试
- **输入**：按F10或反斜杠键
- **预期**：弹出密码输入对话框
- **验证**：输入正确密码后程序正常退出

### 用例4：系统资源测试
- **输入**：程序运行30分钟
- **预期**：内存使用稳定，无明显泄漏
- **验证**：任务管理器监控内存/CPU使用率

## 故障排除指南

### 常见错误及解决方案

**错误1: "应用程序无法正常启动(0xc000007b)"**
```
原因：缺少VC++ Runtime或架构不匹配
解决：安装正确版本的VC++ 2017 Redistributable (x86)
```

**错误2: "程序停止工作"（无具体错误信息）**
```
原因：WebEngine GPU进程崩溃
解决：设置环境变量QTWEBENGINE_DISABLE_GPU=1
命令：set QTWEBENGINE_DISABLE_GPU=1 && zdf-exam-desktop.exe
```

**错误3: 网页显示空白**
```
原因：沙箱模式不兼容
解决：检查QTWEBENGINE_DISABLE_SANDBOX环境变量是否生效
```

**错误4: 内存不足导致崩溃**
```
原因：2GB内存对WebEngine来说较为紧张
解决：关闭其他应用程序，释放更多内存
```

## 日志分析

### 关键日志文件
- `log/startup.log` - 程序启动过程
- `log/app.log` - 应用程序运行状态  
- `log/config.log` - 配置文件加载情况
- `log/exit.log` - 退出尝试记录

### 需要关注的日志信息
```
检测到Windows 7系统，启用兼容模式
应用Windows 7 WebEngine兼容性补丁
程序启动成功，使用配置文件: xxx
```

## 成功标准

### 最低要求
- [ ] 程序能够启动而不崩溃
- [ ] 网页内容正常显示
- [ ] 热键退出功能正常

### 理想目标  
- [ ] 运行稳定，无内存泄漏
- [ ] 响应速度可接受
- [ ] 所有安全功能正常工作

## 应急方案

如果QtWebEngine仍然无法在Windows 7上稳定运行：

1. **回退到QWebView**：使用IE内核，牺牲部分现代Web标准支持
2. **外部浏览器集成**：启动系统默认浏览器，通过IPC通信控制
3. **系统要求升级**：建议用户升级到Windows 10以获得最佳体验

## 测试报告模板

```
测试日期：________
测试人员：________
系统版本：Windows 7 SP1 Build 7601 (x86)
Chrome版本：109.xxx.xxx

测试结果：
□ 通过 □ 失败

详细说明：
- 启动时间：___秒
- 内存占用：___MB  
- 发现问题：________
- 解决方案：________

建议：
________
```